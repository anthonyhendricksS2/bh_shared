#!/usr/bin/env python3

TARGET_SERVICE_ACCOUNT = ''
ACCESS_TOKEN = input('Enter an access token to use for authentication: ').rstrip()

from apiclient.discovery import build
import google.oauth2.credentials
import json

credentials = google.oauth2.credentials.Credentials(ACCESS_TOKEN)
service = build(serviceName='iamcredentials', version='v1', credentials=credentials)

body = {
    'scope': [
        'https://www.googleapis.com/auth/iam',
        'https://www.googleapis.com/auth/cloud-platform'
    ]
}

res = service.projects().serviceAccounts().generateAccessToken(name=f'projects/-/serviceAccounts/{TARGET_SERVICE_ACCOUNT}', body=body).execute()

print(json.dumps(res, indent=4))
